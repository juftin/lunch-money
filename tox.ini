[tox]
envlist =
    py36
    py37
    py38
    py39
    flake8
    yamllint
    mypy

[testenv]
changedir = tests
extras =
    dev
    lunchwise
passenv =
    LUNCHMONEY_ACCESS_TOKEN
commands =
;FLAKE8 SYNTAX CHECK
    flake8 {toxinidir}/lunchmoney {toxinidir}/tests --count --select=E9,F63,F7,F82 --show-source --statistics
;PYTEST UNITTESTS
    coverage erase
    coverage run -m pytest -rA {posargs}
;COVERAGE REPORT
    coverage report -m --omit='{toxinidir}/.tox/*,{toxinidir}/tests/*'

[testenv:flake8]
changedir = {toxinidir}
skip_install = true
deps =
    flake8
    flake8-bugbear
    flake8-docstrings
    flake8-typing-imports
    pep8-naming
commands =
    flake8 lunchmoney/ tests/ setup.py

[testenv:yamllint]
changedir = {toxinidir}
skip_install = true
deps =
    yamllint
commands =
    yamllint {toxinidir} -c {toxinidir}/.github/config/yamllint.yml

[testenv:mypy]
changedir = {toxinidir}
deps =
    mypy
commands =
    mypy --install-types --non-interactive {toxinidir}/lunchmoney

[testenv:markdown-lint]
whitelist_externals =
    node
    markdownlint
passenv = *
commands =
    node --version
    markdownlint --version
    markdownlint README.md CONTRIBUTING.md docs/ --ignore docs/CNAME

[flake8]
accept-encodings = utf-8
docstring-convention = numpy
exclude =
    .git,
    __pycache__,
    docs,
    build,
    dist
max-complexity = 10
max-line-length = 100
ignore =
; D200 - One-line docstring should fit on one line with quotes [Whitespace Issues]
; D400 - First line should end with a period [Docstring Content Issues]
; D401 - First line should be in imperative mood; try rephrasing [Docstring Content Issues]
    D200
    D400
    D401
per-file-ignores =
    tests/plugins/lunchwise/test_splitwise.py:F401
